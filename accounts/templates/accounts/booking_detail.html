<!-- templates/accounts/booking_detail.html -->

{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/booking_details.css' %}">
{% endblock %}

{% block content %}
<div class="container">
    <div class="row">
        <!-- Details Section -->
        <div class="col-md-6">
            <h2>Booking Details</h2>
            <p><strong>Pickup Location:</strong> {{ booking.pickup_location }}</p>
            <p><strong>Dropoff Location:</strong> {{ booking.dropoff_location }}</p>
            <p><strong>Date:</strong> {{ booking.date }}</p>
            <p><strong>Status:</strong> {{ booking.get_status_display }}</p>

            {% if driver_profile %}
                <h3>Driver Details</h3>
                <p><strong>Driver Name:</strong> {{ driver_profile.user.username }}</p>
                <p><strong>Driver's Current Location:</strong> {{ driver_profile.current_location }}</p>
            {% else %}
                <p>No driver has accepted this booking yet.</p>
            {% endif %}

            <a href="{% url 'accounts:user_dashboard' %}" class="btn btn-secondary">Back to Dashboard</a>
        </div>

        <!-- Map and Distance Section -->
        {% if driver_profile and driver_profile.current_location %}
        <div class="col-md-6">
            <div id="map" style="height: 400px; width: 100%;"></div>
            <div id="details">
                <div class="form-group">
                    <label for="distance-display">Distance:</label>
                    <input id="distance-display" class="form-control" readonly />
                </div>
                <div class="form-group">
                    <label for="duration-display">Estimated Time:</label>
                    <input id="duration-display" class="form-control" readonly />
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCbSg7br_mo3_MCZqmYr84H5t5UdWaL8GU&libraries=places"></script>

{% if driver_profile and driver_profile.current_location %}
    <script>
        var driverCurrentLocation = "{{ driver_profile.current_location|escapejs }}";
        var bookingDropoffLocation = "{{ booking.dropoff_location|escapejs }}";
    </script>
    <script src="{% static 'js/booking_details.js' %}"></script>
{% endif %}
{% endblock %}
